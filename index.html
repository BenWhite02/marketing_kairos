<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kairos - Perfect Moment Marketing Platform</title>
    
    <!-- Favicon and App Icons -->
    <link rel="icon" type="image/svg+xml" href="/images/logo.svg" />
    <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png" />
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Kairos - The enterprise marketing decisioning platform that delivers the right message to the right customer at the perfect moment." />
    <meta name="keywords" content="marketing automation, customer decisioning, perfect timing, marketing moments" />
    <meta name="author" content="Kairos Platform" />
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Kairos - Perfect Moment Marketing" />
    <meta property="og:description" content="Transform marketing decisioning with AI-powered perfect moment delivery." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://kairos.marketing" />
    <meta property="og:image" content="/images/og-image.jpg" />
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Kairos - Perfect Moment Marketing" />
    <meta name="twitter:description" content="Transform marketing decisioning with AI-powered perfect moment delivery." />
    <meta name="twitter:image" content="/images/twitter-card.jpg" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#3B82F6" />
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="/fonts/inter-var.woff2" as="font" type="font/woff2" crossorigin />
    
    <!-- Critical CSS (inline for performance) -->
    <style>
        /* Critical loading styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #1f2937;
            overflow-x: hidden;
        }
        
        /* Loading screen styles */
        .app-loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            z-index: 9999;
        }
        
        .loading-content {
            text-align: center;
            max-width: 400px;
            padding: 2rem;
        }
        
        .kairos-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
            animation: logoFloat 3s ease-in-out infinite;
        }
        
        .kairos-logo span {
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
            font-family: 'Arial', sans-serif;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        .loading-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .loading-subtext {
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 2rem;
        }
        
        .loading-progress {
            width: 200px;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            margin: 0 auto;
            overflow: hidden;
            position: relative;
        }
        
        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            border-radius: 2px;
            animation: progressLoad 2s ease-in-out infinite;
        }
        
        .emergency-redirect {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            opacity: 0;
            animation: fadeInUp 1s ease-out 2s forwards;
        }
        
        .emergency-redirect p {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }
        
        .emergency-redirect button {
            background: #ef4444;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .emergency-redirect button:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }
        
        /* Animations */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes progressLoad {
            0% { width: 0%; margin-left: 0%; }
            50% { width: 75%; margin-left: 12.5%; }
            100% { width: 0%; margin-left: 100%; }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
        
        /* Hide loading when React app loads */
        .app-loaded .app-loading {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }
    </style>
</head>
<body>
    <!-- App Loading Screen -->
    <div class="app-loading" id="app-loading">
        <div class="loading-content">
            <!-- Kairos Logo -->
            <div class="kairos-logo">
                <span>K</span>
            </div>
            
            <!-- Loading Spinner -->
            <div class="loading-spinner"></div>
            
            <!-- Loading Text -->
            <div class="loading-text">Loading Kairos</div>
            <div class="loading-subtext">Initializing your perfect moment platform...</div>
            
            <!-- Progress Bar -->
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
        
        <!-- Emergency Fallback -->
        <div class="emergency-redirect">
            <p>Taking longer than expected?</p>
            <button onclick="handleEmergencyFallback()">Emergency HTML Dashboard</button>
        </div>
    </div>
    
    <!-- React App Mount Point -->
    <div id="root"></div>

    <!-- Critical JavaScript for loading and emergency handling -->
    <script>
        // App loading management
        let appLoadTimeout;
        let emergencyMode = false;
        
        // Start loading timeout
        appLoadTimeout = setTimeout(() => {
            console.warn('‚ö†Ô∏è React app taking longer than expected to load');
            showEmergencyOption();
        }, 5000);
        
        // Show emergency fallback option
        function showEmergencyOption() {
            const emergencyEl = document.querySelector('.emergency-redirect');
            if (emergencyEl) {
                emergencyEl.style.opacity = '1';
            }
        }
        
        // Handle emergency fallback
        function handleEmergencyFallback() {
            console.log('üö® EMERGENCY: Switching to HTML dashboard...');
            emergencyMode = true;
            
            // Clear the loading screen
            const loadingEl = document.getElementById('app-loading');
            if (loadingEl) {
                loadingEl.style.display = 'none';
            }
            
            // Create emergency HTML content
            document.body.innerHTML = `
                <div style="min-h: 100vh; display: flex; align-items: center; justify-content: center; background: #f8fafc;">
                    <div style="text-align: center; max-width: 500px; padding: 2rem;">
                        <div style="width: 80px; height: 80px; margin: 0 auto 1.5rem; background: linear-gradient(135deg, #ef4444, #dc2626); border-radius: 20px; display: flex; align-items: center; justify-content: center;">
                            <span style="color: white; font-size: 2.5rem; font-weight: bold;">!</span>
                        </div>
                        <h1 style="font-size: 1.5rem; font-weight: bold; color: #111827; margin-bottom: 1rem;">
                            React App Loading Failed
                        </h1>
                        <p style="color: #6b7280; margin-bottom: 2rem;">
                            The React application failed to load properly. This usually indicates a build issue or missing dependencies.
                        </p>
                        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                            <button onclick="window.location.reload()" style="background: #3b82f6; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 500; cursor: pointer;">
                                üîÑ Retry React App
                            </button>
                            <button onclick="window.location.href='/dashboard.html'" style="background: #ef4444; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 500; cursor: pointer;">
                                üì± Use HTML Dashboard
                            </button>
                        </div>
                        <div style="margin-top: 2rem; padding: 1rem; background: #fef3c7; border-radius: 8px; text-align: left;">
                            <h3 style="font-size: 0.9rem; font-weight: 600; color: #92400e; margin-bottom: 0.5rem;">
                                üîß Troubleshooting Steps:
                            </h3>
                            <ul style="font-size: 0.8rem; color: #92400e; margin-left: 1rem;">
                                <li>Check if the development server is running</li>
                                <li>Verify all dependencies are installed (npm install)</li>
                                <li>Check the browser console for error messages</li>
                                <li>Try clearing browser cache and reloading</li>
                                <li>Ensure HADES backend is running on localhost:8080</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Mark app as loaded when React takes over
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Kairos: DOM loaded, waiting for React...');
        });
        
        // React app loaded successfully
        window.markAppLoaded = () => {
            console.log('‚úÖ Kairos: React app loaded successfully!');
            clearTimeout(appLoadTimeout);
            
            if (!emergencyMode) {
                document.body.classList.add('app-loaded');
                setTimeout(() => {
                    const loadingEl = document.getElementById('app-loading');
                    if (loadingEl) {
                        loadingEl.remove();
                    }
                }, 500);
            }
        };
        
        // Emergency HTML redirect handler (for old bookmarks)
        if (window.location.pathname === '/dashboard.html' || window.location.search.includes('emergency=true')) {
            console.log('üîÑ EMERGENCY HTML REDIRECT: Detected old HTML route, redirecting to React...');
            window.history.replaceState({}, '', '/login?from=emergency');
        }
        
        // Log initial load
        console.log('üéØ Kairos: Starting React application...');
        console.log('üìç Current path:', window.location.pathname);
        console.log('üîó Full URL:', window.location.href);
    </script>
    
    <!-- React App Script (Vite will inject this) -->
    <script type="module" src="/src/main.tsx"></script>
</body>
</html>